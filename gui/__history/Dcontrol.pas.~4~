unit Dcontrol;

{-------------------------------------------------------------------}
{                    Unit:    Dcontrol.pas                          }
{                    Project: ITM                                   }
{                    Version: 2.0                                   }
{                    Date:    03/04/23                              }
{                                                                   }
{   Dialog form unit for editing a link's control properties.       }
{-------------------------------------------------------------------}

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Samples.Spin,
  Vcl.ExtCtrls, Uglobals, Uproject;

type
  TControlDataForm = class(TForm)
    ControlTypeGroup: TRadioGroup;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    InitSettingEdit: TSpinEdit;
    Label5: TLabel;
    CloseTimeEdit: TSpinEdit;
    Label6: TLabel;
    Label7: TLabel;
    TseriesCombo: TComboBox;
    NodeCombo: TComboBox;
    CurveCombo: TComboBox;
    Button1: TButton;
    Button2: TButton;
    Button3: TButton;
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
    CtrlIndex: Integer;
  public
    { Public declarations }
    procedure LoadData(const ObjType: Integer; const Index: Integer);
    function GetControlType: String;
  end;

var
  ControlDataForm: TControlDataForm;

implementation

{$R *.dfm}

procedure TControlDataForm.FormCreate(Sender: TObject);
var
  I, J: Integer;
begin
  for I := JUNCTION to STORAGE do
  begin
    for J := 0 to Project.Lists[I].Count-1 do
      NodeCombo.Items.Add(Project.GetID(I, J));
  end;
  NodeCombo.ItemIndex := 0;
end;

function TControlDataForm.GetControlType: string;
begin
  with ControlTypeGroup do
    Result := Items[ItemIndex];
end;

procedure TControlDataForm.LoadData(const ObjType: Integer; const Index: Integer);
var
  L: TLink;
  I: Integer;
begin
  L := Project.GetLink(ObjType, Index);
  case ObjType of
  PUMP:    CtrlIndex := PUMP_CONTROL_INDEX;
  ORIFICE: CtrlIndex := ORIFICE_CONTROL_INDEX;
  WEIR:    CtrlIndex := WEIR_CONTROL_INDEX;
  else     exit;
  end;
  ControlTypeGroup.ItemIndex := 0;
  if SameText(L.Data[CtrlIndex], 'TIME') then
    ControlTypeGroup.ItemIndex := 1;
  if SameText(L.Data[CtrlIndex], 'DEPTH') then
    ControlTypeGroup.ItemIndex := 2;
  InitSettingEdit.Text := L.Data[CtrlIndex+1];
  CloseTimeEdit.Text := L.Data[CtrlIndex+2];
  TseriesCombo.Text := L.Data[CtrlIndex+3];
  NodeCombo.Text := L.Data[CtrlIndex+4];
  CurveCombo.Text := L.Data[CtrlIndex+5];
end;

end.
